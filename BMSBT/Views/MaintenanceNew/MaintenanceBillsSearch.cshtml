@model PaginationViewModel<BMSBT.ViewModels.MaintenanceBillViewModel>
@{
    ViewData["Title"] = "Search Maintenance Bills";
    Layout = "~/Views/Shared/_LayoutMaintBills.cshtml";
}

@if (!ViewBag.ShowGrid)
{
    <div class="alert alert-warning">
        @ViewBag.Message
    </div>
}


<style>
    .form-label {
        font-weight: 500;
        white-space: nowrap;
    }

    .form-control {
        height: 45px;
    }

    .filter-section {
        padding: 20px;
        background-color: #f8f9fa;
        border-radius: 6px;
        margin-bottom: 20px;
    }

    .btn-space-bottom {
        margin-bottom: 30px; /* or any value you prefer */
    }
</style>

<form asp-action="MaintenanceBillsSearch" method="get" class="filter-section">
    <div class="form-row row align-items-end g-2">

        <div class="form-group col-auto">
            <label class="form-label">Month:</label>
            <select name="billingMonth" class="form-control">
                <option value="">-- Select Month --</option>
                @foreach (var month in ViewBag.Months as List<string>)
                {
                    <option value="@month" selected="@(month == Context.Request.Query["billingMonth"])">@month</option>
                }
            </select>
        </div>

        <div class="form-group col-auto">
            <label class="form-label">Year:</label>
            <select name="billingYear" class="form-control">
                <option value="">-- Select Year --</option>
                @foreach (var year in ViewBag.Years as List<string>)
                {
                    <option value="@year" selected="@(year == Context.Request.Query["billingYear"])">@year</option>
                }
            </select>
        </div>

        <div class="form-group col-auto">
            <label class="form-label">Block:</label>
            <select class="form-control" name="block">
                <option value="">-- Select Block --</option>
                @foreach (var blockItem in ViewBag.Blocks)
                {
                    <option value="@blockItem" selected="@(blockItem == ViewBag.SelectedBlock)">
                        @blockItem
                    </option>
                }
            </select>
        </div>

        <div class="form-group col-auto">
            <label class="form-label">BT No:</label>
            <input type="text" name="btNo" class="form-control" placeholder="Enter BT No" value="@Context.Request.Query["btNo"]" />
        </div>

        <div class="form-group col-auto">
            <button type="submit" class="btn btn-primary mt-2">Search</button>
        </div>

    </div>
</form>



@if (ViewBag.ShowGrid == true)
{
    <form method="post" asp-action="GenerateBills">
        <div class="text-end mt-2 mb-4">
            <button type="submit" class="btn btn-success">Generate Bills</button>
        </div>
    <div class="table-responsive">
        <table class="table table-bordered table-striped">
            <thead class="thead-dark">
                <tr>
                    <th><input type="checkbox" id="selectAll" /></th>
                    <th>Customer Name</th>
                    <th>BT No</th>
                    <th>Block</th>
                    <th>Billing Month</th>
                    <th>Billing Year</th>
                    <th>Amount Due Date</th>
                    <th>Amount After Due Date</th>
                    <th>Due Date</th>
                    <th>Status</th>
                    <th></th>
                    <th></th>
                </tr>
            </thead>
            <tbody>
                @if (Model.Items.Any())
                {
                    @foreach (var item in Model.Items)
                    {
                        <tr>
                                <td>
                                    <input type="checkbox" name="selectedBtno" value="@item.Btno" />
                                </td>
                            <td>@item.CustomerName</td>
                            <td>@item.Btno</td>
                            <td>@item.Block</td>
                            <td>@item.BillingMonth</td>
                            <td>@item.BillingYear</td>
                            <td>@item.BillAmountInDueDate?.ToString()</td>
                            <td>@item.BillAmountAfterDueDate?.ToString()</td>
                            <td>@item.DueDate?.ToString("dd-MMMM-yyyy")</td>
                            <td>@item.PaymentStatus</td>
                            <td> <a asp-action="Details" asp-route-id="@item.Uid" class="btn btn-info btn-sm">Details</a></td>
                            <td><a asp-action="Edit" asp-route-id="@item.Uid" class="btn btn-warning btn-sm">Edit</a> </tr>
                    }
                }
                else
                {
                    <tr>
                        <td colspan="9" class="text-center">No records found</td>
                    </tr>
                }
            </tbody>
        </table>
          
        </div>
    </form>
   
   
    @if (Model.TotalPages > 1)
    {
        <nav aria-label="Page navigation">
            <ul class="pagination justify-content-center">
                <li class="page-item @(!Model.HasPreviousPage ? "disabled" : "")">
                    <a class="page-link"
                       asp-action="MaintenanceBillsSearch"
                       asp-route-page="@(Model.PageNumber - 1)"
                       asp-route-billingMonth="@Context.Request.Query["billingMonth"]"
                       asp-route-billingYear="@Context.Request.Query["billingYear"]"
                       asp-route-block="@Context.Request.Query["block"]"
                       asp-route-btNo="@Context.Request.Query["btNo"]">
                        Previous
                    </a>
                </li>

                @for (int i = 1; i <= Model.TotalPages; i++)
                {
                    <li class="page-item @(i == Model.PageNumber ? "active" : "")">
                        <a class="page-link"
                           asp-action="MaintenanceBillsSearch"
                           asp-route-page="@i"
                           asp-route-billingMonth="@Context.Request.Query["billingMonth"]"
                           asp-route-billingYear="@Context.Request.Query["billingYear"]"
                           asp-route-block="@Context.Request.Query["block"]"
                           asp-route-btNo="@Context.Request.Query["btNo"]">
                            @i
                        </a>
                    </li>
                }

                <li class="page-item @(!Model.HasNextPage ? "disabled" : "")">
                    <a class="page-link"
                       asp-action="MaintenanceBillsSearch"
                       asp-route-page="@(Model.PageNumber + 1)"
                       asp-route-billingMonth="@Context.Request.Query["billingMonth"]"
                       asp-route-billingYear="@Context.Request.Query["billingYear"]"
                       asp-route-block="@Context.Request.Query["block"]"
                       asp-route-btNo="@Context.Request.Query["btNo"]">
                        Next
                    </a>
                </li>
            </ul>
        </nav>

        <div class="text-center text-muted">
            Showing @((Model.PageNumber - 1) * Model.PageSize + 1) to
            @(Math.Min(Model.PageNumber * Model.PageSize, Model.TotalRecords)) of @Model.TotalRecords records
        </div>
       
    }
}
<script>
    document.getElementById('selectAll').addEventListener('click', function () {
        const checkboxes = document.querySelectorAll('input[name="selectedBtno"]');
        checkboxes.forEach(cb => cb.checked = this.checked);
    });
</script>
